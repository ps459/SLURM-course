\part{HPC Basics}
\frame{\partpage}

\begin{frame}{HPC Basics: Our Clusters}
\begin{itemize}
\item{Our clusters are built using lots of commodity servers which then operate as a 'super computer'.}
\pause
\item{We have CPU and GPU cluster nodes.}
\pause
\item{A cluster has a scheduler which runs jobs from a queue.}
\pause
\item{You submit jobs to the queue using a submission script.}
\pause
\item{Jobs have service levels and QOS (quality of service) associated with them.}
\pause
\item{There is a user environment this allows you to load or unload versions of software.}
\pause
\item{We will look at each of these aspects in more detail during the course.}
\end{itemize}
\end{frame}

\section{Why use an HPC cluster?}
\begin{frame}{HPC Basics: Why use an HPC cluster?}
There are many reasons why you may need to use a big computer or cluster. 
\begin{description}
\pause
\item[\textit{Limited local resources:}]{Your jobs can no longer run on your own computer or run very slowly.}
\pause
\item[\textit{Storage Intensive:}]{Your data will exceed that of your local storage capacity.}
\pause
\item[\textit{Software:}]{Many of the software packages you require have a complex installation process or require specialist support.}
\pause
\item[\textit{Grants and sharing:}]{You want to make the best use of your grant when buying computing resources or need to share data or a workflow with your group.}
\end{description}
\end{frame}

\section{Types of job}
\begin{frame}{HPC Basics: Types of problem part 1.}
In this section we will cover high throughput and compute intensive jobs. We will  introduce the user and module environment and submit some High Throughput jobs to some CPU nodes.
\begin{description}
\pause
\item[\textit{High Throughput:}]{Many unrelated problems to be executed in bulk.}
\pause
\item[\textit{Compute Intensive:}]{A single problem requiring a large amount of computation.}
\end{description}
\end{frame}

\subsection{High Throughput}
\begin{frame}{HPC Basics: High Throughput}
\begin{itemize}
\item{Distribute \alert{independent}, \alert{multiple problems} across multiple CPUs to reduce the overall execution time.}
\pause
\item{Workload is trivially (or \emph{embarrassingly}) parallel:}
\begin{itemize}
\item[$\ast$]{Workload breaks up naturally into \emph{independent} pieces.}
\item[$\ast$]{Each piece is performed by a separate process/thread on a separate CPU (concurrently).}
\item[$\ast$]{\alert{Little or no inter-CPU communication}.}
\end{itemize}
\pause
\item{Emphasis is on throughput over a period, rather than on performance on a single problem.}
\pause
%\item{Compute intensive capable $\Rightarrow$ high throughput capable}
%\pause
%\item{\color{red}Compute intensive capable $\not\Leftarrow$ high throughput capable} 
\end{itemize}
\end{frame}

\subsection{Data Intensive}
\begin{frame}{HPC Basics: Data Intensive Problems}
\begin{itemize}
\item{Distribute the \alert{data} for a \alert{single problem} across multiple CPUs to reduce the overall execution time.}
\pause
\item{The \emph{same} work may be done on each data segment.}
\pause
\item{Rapid movement of data to and from disk is more important than inter-CPU communication.}
\pause
\item{\alert{Big Data} problems of great current interest -}
\item{Hadoop/MapReduce}
\item{Life Sciences (genomics) and elsewhere.}
\end{itemize}
\end{frame}

\subsection*{Summary}
\begin{frame}{HPC Basics: Summary}
  \begin{itemize}
  \item<1->{\alert{Why have a supercomputer?}}
  \begin{itemize}\item<2->{Big single problems, many problems, Big Data.}\end{itemize}
  \item<3->{Most current supercomputers are \alert{clusters} of separate \alert{nodes}.}
  \end{itemize}
  
\end{frame}

\section{User Environment Introduction}
\begin{frame}{HPC Basics: User Environment}
\begin{itemize}
\item{The user environment can be changed by loading modules.}
\item{At login some default modules are loaded.}
\item{When you start to compile software or write your own programs you will need to know more about your user environment and the underlying hardware.}
\end{itemize}
\end{frame}

\section{User Environment}
\begin{frame}{HPC Basics: User Environment}
\begin{itemize}
\item<1,4>{\visible<1>{Scientific Linux 6.8 (}\alert<1>{{\color<4>{red}Red Hat Enterprise Linux 6}\visible<1>{.8 rebuild)}}}
\begin{itemize}
\item{\visible<1>{bash}}
\item{\visible<1>{GNOME2 or XFCE4 desktop \alert{(if you want)}}}
\end{itemize}
%\item<1,4>{\visible<1>{Lustre 2.4.1 (patched), Mellanox OFED 3.3,} {\color<4>{red}CUDA 8}\visible<1>{.0}}
\item<1,4>{\visible<1>{Lustre (patched), Mellanox OFED, CUDA}}
\item<2->{But you don't need to know that. \visible<3->{\alert{(Probably\ldots)}}}
\item<5->{Upgrade to Scientific Linux/Red Hat Enterprise Linux 7 underway (Wilkes and new CSD 3 nodes are already on SL7).}
\end{itemize}
\end{frame}

\subsection{Filesystems}
\begin{frame}{User Environment: Filesystems}
When you apply for an HPC account a home directory is created for you. 
\begin{itemize}
\item{\alert{/home/abc123}}
\begin{itemize}
\item{40GB quota.}
\item{Visible equally from all nodes.}
\item{Single storage server.}
\item{Hourly, daily, weekly snapshots copied to tape.}
\item{Not intended for job outputs or large/many input files.}
\end{itemize}
\item{\alert{/scratch/abc123}}
\begin{itemize}
\item{Visible equally from all nodes.}
\item{Larger and faster (1TB initial quota).}
\item{Intended for job inputs and outputs.}
\item{{\color{red}Not backed up.}}
 \pause
\end{itemize}
\end{itemize}
\end{frame}

\subsection{Exceeding 1TB of scratch}
\begin{frame}{Our storage services}
\begin{itemize}
\item{We have several storage services for users that need to exceed 1TB.}
\pause
\item{\alert{http://www.uis.cam.ac.uk/initiatives/storage-strategy/storage-services}}
\item{The most relevant services to HPC are RCS and RDS.}
\item{RCS - Research Cold Store is for data that isn't changing, data goes to disk then two sets of tapes.}
\item{RDS - Research Data Store, non backed up high performance storage for projects.}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Filesystems: Quotas}
\begin{itemize}
\item{quota}
\begin{semiverbatim}
\tiny
====================================================================================
Usage on /scratch (lfs quota -u abc123 /scratch):
====================================================================================
Disk quotas for user abc123 (uid 456):
      Filesystem  kbytes   quota   limit   grace   files   quota   limit   grace
 /scratch/abc123 \only<1|handout:1>{9298708}\only<2-|handout:2->{{\color{red}*1073742000}}  1073741824 1181116006   -   165588       0       0       -
...
\end{semiverbatim}
\item<1-|handout:1->{\alert{Aim to stay below the soft limit (\emph{quota}).}}
\item<2-|handout:1->{\alert{Once over the soft limit, you have 7 days grace to return below.}}
\item<3-|handout:2>{\alert{When the grace period expires, or you reach the hard limit (\emph{limit}), no more data can be written.}}
\item<4-|handout:2>{\alert{It is important to rectify an out of quota condition ASAP.}}
\end{itemize}
\end{frame}

\begin{frame}{Filesystems: Backups}
\begin{itemize}
\item<1->{Disk snapshots and tape (as of May 2017).}
\item<2->{{\color{red}They are not an undelete - take care when deleting.}}
\item<3->{Successful restoration depends on:}
\begin{itemize}
\item{The file having existed long enough to have been backed up at all.}
\item{The last good version existing in a current backup.}
\item<4->{\color{red}Request restoration as soon as possible with \emph{location} and \emph{exact time of loss}.}
\medskip
\visible<5->{\item{\color{purple}\huge Scratch files are not backed up.}}
\end{itemize}
\end{itemize}
\end{frame}

\begin{frame}{Filesystems: Automounter}
\begin{itemize}
\item{Directories under /scratch are \alert{automounted}.}
\item{They only appear under /scratch when explicitly referenced.}
\item{Thus when browsing /scratch may appear too empty\hfill\\
\qquad\alert{--- use \emph{ls} or \emph{cd} to reference /scratch/abc123 explicitly.}}
\end{itemize}
\end{frame}

\begin{frame}{Filesystems: Permissions}
\begin{itemize}
\item{\color{red}Be careful and if unsure, please ask support@hpc.cam.ac.uk.}
\begin{itemize}
\item{Can lead to \alert{accidental destruction} of your data or \alert{account compromise}.}
\end{itemize}
\item{Avoid changing the permissions on your home directory.}
\begin{itemize}
\item{Files under /home are particularly security sensitive.}
\item{Easy to break passwordless communication between nodes.}
\end{itemize}
\end{itemize}
\end{frame}

\section{Software}
\begin{frame}{Using HPC: Software}
\begin{itemize}
\item{Free software accompanying \alert{Red Hat Enterprise} is (or can be) provided.}
\item{Other software (free and non-free) is available via \alert{modules}.}
\item{Some proprietary software may not be generally accessible.}
\item{See \alert{http://www.hpc.cam.ac.uk/using-clusters/software}.}
\item{New software may be possible to provide on request.}
\item{\alert{Self-installed software must be properly licensed.}}
  \pause
\item{\color{red}\emph{sudo will not work.}\/ (You should be worried if it did.)}
\end{itemize}
\end{frame}

\subsection{Environment Modules Pt 1}
\begin{frame}[fragile]{User Environment: Environment Modules}
\begin{itemize}
\item{Modules load or unload additional software packages.}
\item{Some are \alert{required} and automatically loaded on login.}
\item{Others are optional extras, or possible replacements for other modules.}
\item{\alert{Beware} unloading default modules in $\tilde{}\text{/.bashrc}$.}
\item{\alert{Beware} overwriting environment variables such as PATH and LD\_LIBRARY\_PATH in $\tilde{}\text{/.bashrc}$. If necessary append or prepend.}
\end{itemize}
\end{frame}

\subsection{Environment Modules Pt 2}
\begin{frame}[fragile]{User Environment: Environment Modules}
\begin{itemize}
\item{Currently loaded:}
\begin{semiverbatim}
\scriptsize
module list
Currently Loaded Modulefiles:
  1) dot                     6) intel/impi/4.1.3.045   11) default-impi
  2) scheduler               7) global                 
  3) java/jdk1.7.0_60        8) intel/cce/12.1.10.319  
  4) turbovnc/1.1            9) intel/fce/12.1.10.319  
  5) vgl/2.3.1/64           10) intel/mkl/10.3.10.319
\end{semiverbatim}
\medskip
\item{Available:}
\begin{semiverbatim}
\scriptsize
module av
\end{semiverbatim}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{User Environment: Environment Modules}
\begin{itemize}
\item{Show:}
\begin{semiverbatim}
\tiny
module show castep/impi/7.0.3
-------------------------------------------------------------------
/usr/local/Cluster-Config/modulefiles/castep/impi/7.0.3:

module-whatis    adds CASTEP 7.0.3 (Intel MPI) to your environment 

Note that this software is restricted to registered users.

prepend-path     PATH /usr/local/Cluster-Apps/castep/impi/7.0.3/bin:/usr/local/...
-------------------------------------------------------------------
\end{semiverbatim}
\medskip
\item{Load:}
\begin{semiverbatim}
\scriptsize
module load castep/impi/7.0.3
\end{semiverbatim}
\medskip
\item{Unload:}
\begin{semiverbatim}
\scriptsize
module unload castep/impi/7.0.3
\end{semiverbatim}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{User Environment: Environment Modules}
\begin{itemize}
\item{Matlab}
\begin{semiverbatim}
\scriptsize
module load matlab/r2015b
\end{semiverbatim}
\medskip\pause
\item{Invoking matlab in batch mode:\hfill\\
  \qquad \alert{matlab -nodisplay -nojvm -nosplash command}\hfill\\
  where the file \alert{command.m} contains your matlab code.}
  \pause
  \item{The University site license contains the Parallel Computing Toolbox.}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{User Environment: Environment Modules}
\begin{itemize}
\item{Purge:}
\begin{semiverbatim}
\scriptsize
module purge
\end{semiverbatim}
\smallskip
\item{Defaults:}
\begin{semiverbatim}
\scriptsize
module show default-impi
module unload default-impi
module load default-impi-LATEST
\end{semiverbatim}
\medskip
\item{If you have compiled software yourself your run time environment must match compile time environment!}
\end{itemize}
\end{frame}

\subsection{Modules: Excercise 4}
\begin{frame}[fragile]{Excercise 4: Environment Modules}
\begin{itemize}
\item{Connect to the cluster using your training account: See excercise 2 if you have closed your terminal. }
\item{Get a list of modules that are currently loaded}
\item[\emph{Hints:}]{\alert{module list}}
\item{Get a list of available R modules}
\item[\emph{Hints:}]{\alert{module av R}}
\end{itemize}
\end{frame}

\subsection{Modules: Excercise 5}
\begin{frame}[fragile]{Excercise 5: Run an Rscript}
\begin{itemize}
\item{Connect to the cluster using your training account: See excercise 2 if you have closed your terminal. }
\item{In the exercises folder there is a file called test.r}
\item{Run this script using: Rscript hello.r }
\item{Load the module for: R/3.3.2}
\item[\emph{Hints:}]{\alert{module load R/3.3.2}}
\item{Run the script again: Rscript hello.r}
\end{itemize}
\end{frame}

\section{Storage}
\begin{frame}{HPCS: Storage}
\begin{itemize}
\item{Multi-petabytes split across multiple filesystems with tape.}
\item{Lustre cluster filesystem:}
\begin{itemize}
\item[$\ast$]{Multiple RAID6 back-end disk volumes.}
\item[$\ast$]{Multiple object storage servers.}
\item[$\ast$]{Single metadata server.}
\item[$\ast$]{Tape-backed HSM on newest filesystems.}
\pause
\item[$\ast$]{\alert{$4\,\text{GB/sec}$ overall read or write.}}
\pause
\item[$\ast$]{\alert{Prefers big read/writes over small.}}
\end{itemize}
\pause
\item{\alert{For active HPC work only.}}
\end{itemize}
\end{frame}

\section{Service Levels}
\begin{frame}{HPCS: Service Levels}
\begin{description}
\visible<1-4>{\item[\textbf{Service Level 1}]{Paying, intended for large projects with long-term, consistent requirement.}}
\begin{itemize}
\visible<2-4>{\item{\alert{Guaranteed fraction of resources per quarter.}}}
\end{itemize}
\visible<1-5>{\item[\textbf{Service Level 2}]{Paying, intended for medium-sized projects with irregular requirement.}}
\begin{itemize}
\visible<3-5>{\item{\alert{High priority, but no guarantees; \emph{ad hoc}.}}}
\end{itemize}
\visible<1-4>{\item[\textbf{Service Level 3}]{Non-paying, intended for interim or pump priming, small-scale use.}}
\begin{itemize}
\visible<4>{\item{\alert{Low priority, limited usage (200,000 Darwin core hours) per quarter.}}}
\end{itemize}
\end{description}
\end{frame}

\begin{frame}{HPCS: Service Levels}
\begin{description}
\item[\textbf{Service Level 4}]{Non-paying, for when nothing else is available.}
\pause
\item{\alert{Very low priority, very restricted, very limited. Best efforts continuation.}}
\end{description}
\end{frame}

\section{How To Apply}
\begin{frame}{HPCS: How To Apply}
\begin{itemize}
\item{Submit the online application form:\hfill\\
\qquad\alert{\tiny https://www.hpc.cam.ac.uk/services/applying-for-resources/hpc-application}}
\item{The PI should be someone senior enough to have funding.\hfill\\
\qquad E.g.\ \alert{supervisor}, \alert{head of research group}.}
\pause
\item{\color{red}Funding is not necessary.}
\pause
\item{Please email \alert{support@hpc.cam.ac.uk} for all support issues.}
\item{Further information can be found on the web site:\hfill\\
  \qquad \alert{http://www.hpc.cam.ac.uk}}
  \pause
  \item{\alert{Imminent upgrades may introduce changes.}}
\end{itemize}
\end{frame}

\part{Using HPC}
\frame{\partpage}




